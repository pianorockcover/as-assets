{"version":3,"sources":["components/icons.ts","components/RichTextEditor/toolControls.ts","components/RichTextEditor/LinkPicker.tsx","components/RichTextEditor/RichTextEditorTools.tsx","components/RichTextEditor/LinkPreview.tsx","components/RichTextEditor/decorators.ts","components/RichTextEditor/draftMarkdown.ts","components/RichTextEditor/RichTextEditor.tsx","components/Comments/Comment.tsx","components/Comments/Comments.tsx","App.tsx","customTheme.ts","index.tsx"],"names":["icons","List","FormatBold","FormatItalic","FormatUnderlined","Link","SentimentVerySatisfied","Close","Check","FormatListNumberedIcon","ExpandMore","getIcon","icon","richTextControls","type","style","tooltip","text","useStyles","makeStyles","linkPicker","top","left","zIndex","position","background","borderBottom","boxShadow","padding","display","alignItems","justifyContent","paddingLeft","width","input","border","marginRight","outline","transition","paddingTop","paddingBottom","inputError","CloseIcon","CheckIcon","LinkPicker","closeLinkPicker","editorState","setEditorState","classes","presetUrl","contentState","getCurrentContent","startKey","getSelection","getStartKey","startOffset","getStartOffset","linkKey","getBlockForKey","getEntityAt","getEntity","getData","url","useState","setUrl","error","setError","onChange","useCallback","e","target","value","saveUrl","preventDefault","contentStateWithEntity","createEntity","entityKey","getLastCreatedEntityKey","newEditorState","EditorState","set","currentContent","RichUtils","toggleLink","Fade","in","className","placeholder","clsx","IconButton","size","onMouseDown","onClick","richEditorTools","btn","borderRadius","borderRight","textIcon","fontWeight","fontSize","height","paddingRight","RichTextEditorTools","React","memo","setLinkPicker","openLinkPicker","selection","isEmpty","isCollapsed","onToggleControl","toggleBlockType","toggleInlineStyle","currentStyle","getCurrentInlineStyle","blockType","getType","map","control","i","IconComponent","color","has","Tooltip","placement","title","arrow","disabled","link","textDecoration","richTextEditorDecorators","CompositeDecorator","strategy","contentBlock","callback","findEntityRanges","character","component","props","href","children","italicDecorator","richEditorWrapper","marginBottom","richEditorWrapperFocus","borderColor","richEditorArea","overflowY","richEditorAreaFocus","toolsUnfocus","opacity","styleMap","BOLD","LINK","RichTextEditor","defaultValue","forceClean","createWithContent","markdown","convertFromRaw","markdownToDraft","convertMarkdownToDraft","nextEditorState","ref","createRef","focus","setFocus","onBlur","onClickArea","current","useEffect","createEmpty","content","rawObject","convertToRaw","draftToMarkdown","styleItems","ITALIC","open","close","convertDraftToMarkdown","undefined","spellCheck","customStyleMap","comment","author","date","overflow","textHidden","bottom","readMoreButton","marginLeft","readMoreButtonClose","transform","ArrowIcon","SingleComment","hidden","setHidden","needReadMoreButton","setNeedReadMoreButton","initialHeight","getBoundingClientRect","toggleHidden","useMemo","maxHeight","commentsWrapper","comments","marginTop","overflowX","Comments","data","Fragment","key","Button","appWrapper","margin","maxWidth","minHeight","backgroundColor","App","fakeApiComments","setComments","setForceClean","currentComment","setCurrentComment","leaveComment","Date","console","log","variant","customTheme","createMuiTheme","palette","primary","main","overrides","MuiTooltip","ReactDOM","render","StrictMode","CssBaseline","ThemeProvider","theme","document","getElementById"],"mappings":"s2BAaMA,EAEF,CACHC,SACAC,eACAC,iBACAC,qBACAC,SACAC,2BACAC,UACAC,UACAC,2BACAC,gBAGYC,EAAU,SAACC,GAAD,OAAkBZ,EAAMY,I,OCQlCC,EAAkC,CAC9C,CACCC,KAAM,SACNF,KAAM,aACNG,MAAO,OACPC,QAAS,uEAEV,CACCF,KAAM,SACNF,KAAM,eACNG,MAAO,SACPC,QAAS,wCAEV,CACCF,KAAM,QACNC,MAAO,sBACPH,KAAM,OACNI,QAAS,wCAEV,CACCF,KAAM,QACNC,MAAO,oBACPH,KAAM,yBACNI,QAAS,iHAEV,CACCF,KAAM,QACNC,MAAO,aACPE,KAAM,0DAEP,CACCH,KAAM,QACNC,MAAO,eACPE,KAAM,4EAEP,CACCH,KAAM,OACNC,MAAO,GACPH,KAAM,OACNI,QAAS,yC,SCrELE,EAAYC,YAAW,CAC5BC,WAAY,CACXC,IAAK,GACLC,KAAM,EACNC,OAAQ,EACRC,SAAU,WACVC,WAAY,UACZC,aAAc,oBACdC,UAAW,0BACXC,QAAS,EACTC,QAAS,OACTC,WAAY,SACZC,eAAgB,aAChBC,YAAa,GACbC,MAAO,QAERC,MAAO,CACNC,OAAQ,EACRT,aAAc,oBACdU,YAAa,GACbX,WAAY,cACZY,QAAS,kBACTC,WAAY,yBACZC,WAAY,EACZC,cAAe,GAEhBC,WAAY,CACXf,aAAc,uBAIVgB,EAAY/B,EAAQ,SACpBgC,EAAYhC,EAAQ,SAuBbiC,EAAwC,SAAC,GAI/C,IAHNC,EAGK,EAHLA,gBACAC,EAEK,EAFLA,YACAC,EACK,EADLA,eAEMC,EAAU9B,IAEZ+B,EAAY,GACVC,EAAeJ,EAAYK,oBAC3BC,EAAWN,EAAYO,eAAeC,cACtCC,EAAcT,EAAYO,eAAeG,iBAEzCC,EAD2BP,EAAaQ,eAAeN,GACpBO,YAAYJ,GAEjDE,IAEHR,EADqBC,EAAaU,UAAUH,GACnBI,UAAUC,KAZ/B,MAeiBC,mBAAiBd,GAflC,mBAeEa,EAfF,KAeOE,EAfP,OAgBqBD,qBAhBrB,mBAgBEE,EAhBF,KAgBSC,EAhBT,KAkBCC,EAAWC,uBAAY,SAACC,GACzBA,EAAEC,OAAOC,OACZL,GAAS,GAEVF,EAAOK,EAAEC,OAAOC,SACd,IAEGC,EAAUJ,uBACf,SAACC,GAGA,GAFAA,EAAEI,iBAEGX,EAAL,CAKA,IACMY,EADe5B,EAAYK,oBACWwB,aAC3C,OACA,UACA,CAAEb,QAEGc,EAAYF,EAAuBG,0BACnCC,EAAiBC,cAAYC,IAAIlC,EAAa,CACnDmC,eAAgBP,IAGjB3B,EACCmC,YAAUC,WACTL,EACAA,EAAezB,eACfuB,IAGF/B,SAtBCqB,GAAS,KAwBX,CAACpB,EAAagB,IAGf,OACC,cAACsB,EAAA,EAAD,CAAMC,IAAI,EAAV,SACC,sBAAKC,UAAWtC,EAAQ5B,WAAxB,UACC,uBACCN,KAAK,OACLyE,YAAY,kDACZpB,SAAUA,EACVI,MAAOT,EACPwB,UAAWE,YAAKxC,EAAQd,MAAT,eACbc,EAAQP,WAAawB,MAGxB,cAACwB,EAAA,EAAD,CAAYC,KAAK,QAAQC,YAAanB,EAAtC,SACC,cAAC7B,EAAD,MAED,cAAC8C,EAAA,EAAD,CAAYC,KAAK,QAAQE,QAAS/C,EAAlC,SACC,cAACH,EAAD,YCjICxB,EAAYC,YAAW,CAC5B0E,gBAAiB,CAChBnE,aAAc,qBAEfoE,IAAK,CACJlE,QAAS,EACTmE,aAAc,EACdC,YAAa,qBAEdC,SAAU,CACTC,WAAY,IACZC,SAAU,GACVC,OAAQ,GACRtE,WAAY,SACZC,eAAgB,SAChBF,QAAS,OACTG,YAAa,EACbqE,aAAc,KAyBHC,EAA0DC,IAAMC,MAC5E,YAI8C,IAH7C1D,EAG4C,EAH5CA,YACAC,EAE4C,EAF5CA,eACAuC,EAC4C,EAD5CA,UAEMtC,EAAU9B,IAD4B,EAGR6C,qBAHQ,mBAGrC3C,EAHqC,KAGzBqF,EAHyB,KAKtCC,EAAiBtC,uBAAY,WAClC,IAAMuC,EAAY7D,EAAYO,eACzBsD,EAAUC,WAAcD,EAAUE,eACtCJ,GAAc,KAEb,CAAC3D,IAEED,EAAkBuB,uBAAY,kBAAMqC,GAAc,KAAQ,IAE1DK,EAAkB1C,uBACvB,gBAAGtD,EAAH,EAAGA,KAAMC,EAAT,EAASA,MAAT,OAAkC,SACjCsD,GAIA,OAFAA,EAAEI,iBAEM3D,GACP,IAAK,QACAC,GACHgC,EACCmC,YAAU6B,gBAAgBjE,EAAa/B,IAGzC,MACD,IAAK,SACAA,GACHgC,EACCmC,YAAU8B,kBAAkBlE,EAAa/B,IAG3C,MACD,IAAK,OACJ2F,QAIH,CAAC5D,EAAa4D,EAAgB3D,IAGzBkE,EAAenE,EAAYoE,wBAC3BP,EAAY7D,EAAYO,eACxB8D,EAAYrE,EAChBK,oBACAO,eAAeiD,EAAUrD,eACzB8D,UAEF,OACC,qCACC,qBAAK9B,UAAWE,YAAKxC,EAAQ6C,gBAAiBP,GAA9C,SACEzE,EAAiBwG,KAAI,SAACC,EAASC,GAC/B,IAAMC,EACLF,EAAQ1G,MAAQD,EAAQ2G,EAAQ1G,MAC3B6G,EACJH,EAAQvG,OACS,WAAjBuG,EAAQxG,MACRmG,EAAaS,IAAIJ,EAAQvG,QACR,UAAjBuG,EAAQxG,MACRwG,EAAQvG,QAAUoG,EAChB,UACA,UAEJ,OACC,cAACQ,EAAA,EAAD,CAECC,UAAU,SACVC,MAAOP,EAAQtG,SAAW,GAC1B8G,OAAO,EAJR,SAMC,eAACrC,EAAA,EAAD,CACCH,UAAWtC,EAAQ8C,IACnBJ,KAAK,QACLC,YAAamB,EAAgBQ,GAC7BG,MAAOA,EACPM,SAAUT,EAAQS,SALnB,UAOEP,GAAiB,cAACA,EAAD,IACjBF,EAAQrG,MACR,sBAAMqE,UAAWtC,EAAQiD,SAAzB,SACEqB,EAAQrG,WAfPsG,QAuBRnG,GACA,cAAC,EAAD,CACC0B,YAAaA,EACbD,gBAAiBA,EACjBE,eAAgBA,UClJhB7B,EAAYC,YAAW,CAC5B6G,KAAM,CACLP,MAAO,UACPQ,eAAgB,eCDLC,EAA2B,IAAIC,qBAAmB,CAC9D,CACCC,SDgD8B,SAC/BC,EACAC,EACApF,GAH+B,OAK/BmF,EAAaE,kBAAiB,SAACC,GAC9B,IAAM5D,EAAY4D,EAAU5E,YAC5B,OACe,OAAdgB,GACgD,SAAhD1B,EAAaU,UAAUgB,GAAWwC,YAEjCkB,IC1DFG,UD2BqD,SAACC,GACvD,IAAM1F,EAAU9B,IAER4C,EAAQ4E,EAAMxF,aAAaU,UAAU8E,EAAM9D,WAAWf,UAAtDC,IAER,OACC,mBAAGwB,UAAWtC,EAAQgF,KAAMW,KAAM7E,EAAK+D,MAAK,gDAAa/D,GAAzD,SACE4E,EAAME,e,SEhCJC,EAAkB,iBAAM,KCQxB3H,GAAYC,YAAW,CAC5B2H,kBAAmB,CAClBrH,WAAY,UACZU,OALa,oBAMb4G,aAAc,GACdvH,SAAU,WACVc,WAAY,0BAEb0G,uBAAwB,CACvBC,YAAa,WAEdC,eAAgB,CACftH,QAAS,GACTwE,OAAQ,IACR+C,UAAW,OACX7G,WAAY,8BAEb8G,oBAAqB,CACpBzH,UAAW,8BAEZ0H,aAAc,CACbC,QAAS,IACThH,WAAY,6BAIRiH,GAAW,CAChBC,KAAM,CACLtD,WAAY,KAEbuD,KAAM,CACLhC,MAAO,YA+BIiC,GAAgDnD,IAAMC,MAClE,YAKyC,IAJxCmD,EAIuC,EAJvCA,aACAC,EAGuC,EAHvCA,WACArE,EAEuC,EAFvCA,YACGmD,EACoC,2DACjC1F,EAAU9B,KADuB,EAGD6C,mBACrCgB,cAAY8E,kBDlDuB,eAACC,EAAD,uDAAoB,GAApB,OACrCC,yBAAeC,YAAgBF,ICkD5BG,CAAuBN,GACvBzB,IANqC,mBAGhCpF,EAHgC,KAGnBC,EAHmB,KAUjCoB,EAAWC,uBAChB,SAAC8F,GAAD,OAAkCnH,EAAemH,KACjD,IAGKC,EAAMC,sBAf2B,EAgBbrG,qBAhBa,mBAgBhCsG,EAhBgC,KAgBzBC,EAhByB,KAkBjCC,EAASnG,uBAAY,kBAAMkG,GAAS,KAAQ,CAACxH,IAE7C0H,EAAcpG,uBAAY,WAC3B+F,GAAOA,EAAIM,UACdN,EAAIM,QAAQJ,QACZC,GAAS,MAER,CAACH,IAcJ,OAZAO,qBAAU,WACLd,GACH7G,EACCgC,cAAY4F,YAAYzC,MAGxB,CAAC0B,IAEJc,qBAAU,kBAAMhC,EAAMvE,SDvGc,SAACrB,GACtC,IAAM8H,EAAU9H,EAAYK,oBACtB0H,EAAYC,uBAAaF,GAW/B,OATiBG,YAAgBF,EAAW,CAC3CG,WAAY,CACXC,OAAQ,CACPC,KAAMrC,EACNsC,MAAOtC,MC+FsBuC,CAAuBtI,MAAe,CACpEA,IAIA,sBACCwC,UAAWE,YAAKxC,EAAQ8F,kBAAT,eACb9F,EAAQgG,uBAAyBqB,IAFpC,UAKC,cAAC/D,EAAD,CACCxD,YAAaA,EACbC,eAAgBA,EAChBuC,UAAY+E,OAA+BgB,EAAvBrI,EAAQqG,eAE7B,qBACC/D,UAAWE,YAAKxC,EAAQkG,eAAT,eACblG,EAAQoG,oBAAsBiB,IAEhCzE,QAAS4E,EAJV,SAMC,cAAC,SAAD,CACC1H,YAAaA,EACbqB,SAAUA,EACVmH,YAAY,EACZC,eAAgBhC,GAChBgB,OAAQA,EACRJ,IAAKA,EACL5E,YAAaA,Y,+BCzIbrE,GAAYC,YAAW,CAC5BqK,QAAS,CACRzC,aAAc,GACdtH,WAAY,UACZG,QAAS,GACTmE,aAAc,GAEf0F,OAAQ,CACPvF,WAAY,KAEbwF,KAAM,CACLpC,QAAS,GACTP,aAAc,IAEf9H,KAAM,CACL0K,SAAU,SACVnK,SAAU,YAEXoK,WAAY,CACX,UAAW,CACVpK,SAAU,WACVoJ,QAAS,KACTnJ,WAAY,gDACZQ,MAAO,OACPmE,OAAQ,GACRvE,QAAS,QACTgK,OAAQ,EACRtK,OAAQ,IAGVuK,eAAgB,CACfD,OAAQ,EACRrK,SAAU,WACVuK,WAAY,mBACZxK,OAAQ,EACRe,WAAY,uBACZmF,MAAO,WAERuE,oBAAqB,CACpBC,UAAW,iBACXzK,SAAU,YAIN0K,GAAYvL,EAAQ,cA6CbwL,GAAwC5F,IAAMC,MAC1D,YAAqD,IAAlDiF,EAAiD,EAAjDA,OAAQC,EAAyC,EAAzCA,KAAMzK,EAAmC,EAAnCA,KACV+B,GAD6C,wCACnC9B,MAEViJ,EAAMC,sBAHuC,EAKvBrG,qBALuB,mBAK5CqI,EAL4C,KAKpCC,EALoC,OAMCtI,qBAND,mBAM5CuI,EAN4C,KAMxBC,EANwB,KAQnD7B,qBAAU,WACT,GAAIP,GAAOA,EAAIM,QAAS,CACvB,IAAM+B,EAAgBrC,EAAIM,QAAQgC,wBAChCrG,YAEaiF,IAAXe,GAAwBI,EAtDd,MAuDbH,GAAU,GACVE,GAAsB,OAGtB,CAACpC,EAAKiC,IAET,IAAMM,EAAetI,uBAAY,kBAAMiI,GAAWD,KAAS,CAACA,IAEtDhG,EAASuG,mBAAQ,kBAAOP,EA/Dd,SA+DmCf,IAAY,CAC9De,IAGD,OACC,sBAAK9G,UAAWtC,EAAQwI,QAAxB,UACC,qBAAKlG,UAAWtC,EAAQyI,OAAxB,SAAiCA,IACjC,qBAAKnG,UAAWtC,EAAQ0I,KAAxB,SAA+BA,IAC/B,sBACCpG,UAAWE,YAAKxC,EAAQ/B,KAAT,eACb+B,EAAQ4I,WAAaQ,IAEvBjC,IAAKA,EACLpJ,MAAO,CAAE6L,UAAWxG,GALrB,UAOC,cAAC,KAAD,UAAgBnF,IACfqL,GACA,cAAC7G,EAAA,EAAD,CACCC,KAAK,QACLJ,UAAWE,YAAKxC,EAAQ8I,eAAT,eACb9I,EAAQgJ,qBAAuBI,IAEjCxG,QAAS8G,EALV,SAOER,IAAa,cAACA,GAAD,eChJfhL,GAAYC,YAAW,CAC5B0L,gBAAiB,CAChB9D,aAAc,IAEf+D,SAAU,CACTC,UAAW,GACX1G,aAAc,EACduG,UAAW,IACXzD,UAAW,OACX6D,UAAW,YAiBAC,GAAoC1G,IAAMC,MAAK,YAAe,IAAZ0G,EAAW,EAAXA,KACxDlK,EAAU9B,KAEhB,OACC,sBAAKoE,UAAWtC,EAAQ6J,gBAAxB,UACC,qBAAKvH,UAAWtC,EAAQ8J,SAAxB,SACC,cAAC,IAAMK,SAAP,UACED,EAAK7F,KAAI,SAACmE,EAASjE,GAAV,OACT,wBAAC4E,GAAD,6BAAmBX,GAAnB,IAA4B4B,IAAK7F,YAIpC,cAAC8F,EAAA,EAAD,CAAQ5F,MAAM,UAAd,qGACA,cAAC4F,EAAA,EAAD,CAAQ5F,MAAM,UAAd,0D,UCpCGvG,GAAYC,YAAW,CAC5BmM,WAAY,CACXC,OAAQ,SACRC,SAAU,IACVC,UAAW,QACX7L,QAAS,GACTH,WAAY,WAGb,UAAW,CACV,uBAAwB,CACvBQ,MAAO,IAER,6BAA8B,CAC7ByL,gBAAiB,iBACjB3H,aAAc,MAgDF4H,OA3Cf,WACC,IAAM3K,EAAU9B,KADF,EAGkB6C,mBAAyB6J,IAH3C,mBAGPd,EAHO,KAGGe,EAHH,OAIsB9J,qBAJtB,mBAIP6F,EAJO,KAIKkE,EAJL,OAK8B/J,qBAL9B,mBAKPgK,EALO,KAKSC,EALT,KAORC,EAAe7J,uBAAY,WAC5B2J,IACHF,EAAY,CACX,CACCpC,OAAQ,gEACRC,KAAM,mBACNzK,KAAM8M,IAJG,mBAMPjB,KAEJgB,GAAe,IAAII,MACnBF,OAAkB3C,GAElB8C,QAAQC,IAAIL,MAEX,CAACA,EAAgBjB,IAEpB,OACC,sBAAKxH,UAAWtC,EAAQsK,WAAxB,UACC,cAAC5D,GAAD,CACCvF,SAAU6J,EACVpE,WAAYA,IAEb,cAACyD,EAAA,EAAD,CACCgB,QAAQ,YACR5G,MAAM,UACN/B,KAAK,QACLE,QAASqI,EAJV,iIAQA,cAAChB,GAAD,CAAUC,KAAMJ,Q,UChENwB,GAAcC,aAAe,CACzCC,QAAS,CACRC,QAAS,CACRC,KAAM,YAGRC,UAAW,CACVC,WAAY,CACX5N,QAAS,CACRmF,SAAU,GACVD,WAAY,SCNhB2I,IAASC,OACR,eAAC,IAAMC,WAAP,WACC,cAACC,EAAA,EAAD,IACA,cAACC,EAAA,EAAD,CAAeC,MAAOZ,GAAtB,SACC,cAAC,GAAD,SAGFa,SAASC,eAAe,W","file":"static/js/main.6cc88617.chunk.js","sourcesContent":["import List from \"@material-ui/icons/List\";\r\nimport FormatBold from \"@material-ui/icons/FormatBold\";\r\nimport FormatItalic from \"@material-ui/icons/FormatItalic\";\r\nimport Link from \"@material-ui/icons/Link\";\r\nimport FormatUnderlined from \"@material-ui/icons/FormatUnderlined\";\r\nimport { OverridableComponent } from \"@material-ui/core/OverridableComponent\";\r\nimport { SvgIconTypeMap } from \"@material-ui/core\";\r\nimport SentimentVerySatisfied from \"@material-ui/icons/SentimentVerySatisfied\";\r\nimport Close from \"@material-ui/icons/Close\";\r\nimport Check from \"@material-ui/icons/Check\";\r\nimport FormatListNumberedIcon from \"@material-ui/icons/FormatListNumbered\";\r\nimport ExpandMore from \"@material-ui/icons/ExpandMore\";\r\n\r\nconst icons: {\r\n\t[key: string]: OverridableComponent<SvgIconTypeMap<{}, \"svg\">>;\r\n} = {\r\n\tList,\r\n\tFormatBold,\r\n\tFormatItalic,\r\n\tFormatUnderlined,\r\n\tLink,\r\n\tSentimentVerySatisfied,\r\n\tClose,\r\n\tCheck,\r\n\tFormatListNumberedIcon,\r\n\tExpandMore,\r\n};\r\n\r\nexport const getIcon = (icon: string) => icons[icon];\r\n","/**\r\n * Описание кнопки в панели инструментов расширенного редактора текстов\r\n */\r\nexport interface ToolControl {\r\n\t/**\r\n\t * Тип действия кнопки\r\n\t * - inline - включить стиль (например: курсив, жирный)\r\n\t * - block - добавить стилизованный блок (напримр: заголовок, список)\r\n\t * - link - добавить ссылку\r\n\t */\r\n\ttype: \"inline\" | \"block\" | \"link\";\r\n\t/**\r\n\t * Иконка для кнопки\r\n\t */\r\n\ticon?: string;\r\n\t/**\r\n\t * Текст для кнопки\r\n\t */\r\n\ttext?: string;\r\n\t/**\r\n\t * Тип стиля/блока, активируемого кнопкой\r\n\t */\r\n\tstyle?: string;\r\n\t/**\r\n\t * Кнопка неактивна\r\n\t */\r\n\tdisabled?: boolean;\r\n\t/**\r\n\t * Подсказка\r\n\t */\r\n\ttooltip?: string;\r\n}\r\n\r\n/**\r\n * Набор кнопок для панели инструментов расширенного редактора текстов\r\n */\r\nexport const richTextControls: ToolControl[] = [\r\n\t{\r\n\t\ttype: \"inline\",\r\n\t\ticon: \"FormatBold\",\r\n\t\tstyle: \"BOLD\",\r\n\t\ttooltip: \"Жирный шрифт\",\r\n\t},\r\n\t{\r\n\t\ttype: \"inline\",\r\n\t\ticon: \"FormatItalic\",\r\n\t\tstyle: \"ITALIC\",\r\n\t\ttooltip: \"Курсив\",\r\n\t},\r\n\t{\r\n\t\ttype: \"block\",\r\n\t\tstyle: \"unordered-list-item\",\r\n\t\ticon: \"List\",\r\n\t\ttooltip: \"Список\",\r\n\t},\r\n\t{\r\n\t\ttype: \"block\",\r\n\t\tstyle: \"ordered-list-item\",\r\n\t\ticon: \"FormatListNumberedIcon\",\r\n\t\ttooltip: \"Нумерованный список\",\r\n\t},\r\n\t{\r\n\t\ttype: \"block\",\r\n\t\tstyle: \"header-two\",\r\n\t\ttext: \"Заголовок\",\r\n\t},\r\n\t{\r\n\t\ttype: \"block\",\r\n\t\tstyle: \"header-three\",\r\n\t\ttext: \"Подзаголовок\",\r\n\t},\r\n\t{\r\n\t\ttype: \"link\",\r\n\t\tstyle: \"\",\r\n\t\ticon: \"Link\",\r\n\t\ttooltip: \"Ссылка\",\r\n\t},\r\n];\r\n","import { Fade, IconButton, makeStyles } from \"@material-ui/core\";\r\nimport clsx from \"clsx\";\r\nimport { EditorState, RichUtils } from \"draft-js\";\r\nimport React, { ChangeEvent, useCallback, useState } from \"react\";\r\nimport { getIcon } from \"../icons\";\r\n\r\nconst useStyles = makeStyles({\r\n\tlinkPicker: {\r\n\t\ttop: 33,\r\n\t\tleft: 0,\r\n\t\tzIndex: 2,\r\n\t\tposition: \"absolute\",\r\n\t\tbackground: \"#fafdff\",\r\n\t\tborderBottom: \"1px solid #d2d2d2\",\r\n\t\tboxShadow: \"1px 1px 4px 0px #e4e1e1\",\r\n\t\tpadding: 5,\r\n\t\tdisplay: \"flex\",\r\n\t\talignItems: \"center\",\r\n\t\tjustifyContent: \"flex-start\",\r\n\t\tpaddingLeft: 10,\r\n\t\twidth: \"100%\",\r\n\t},\r\n\tinput: {\r\n\t\tborder: 0,\r\n\t\tborderBottom: \"2px solid #0088bb\",\r\n\t\tmarginRight: 10,\r\n\t\tbackground: \"transparent\",\r\n\t\toutline: \"none !important\",\r\n\t\ttransition: \"border .2s ease-in-out\",\r\n\t\tpaddingTop: 3,\r\n\t\tpaddingBottom: 3,\r\n\t},\r\n\tinputError: {\r\n\t\tborderBottom: \"2px solid #ee1d1d\",\r\n\t},\r\n});\r\n\r\nconst CloseIcon = getIcon(\"Close\")!;\r\nconst CheckIcon = getIcon(\"Check\")!;\r\n\r\ninterface LinkPickerProps {\r\n\t/**\r\n\t * Текущий стейт редактора текстов\r\n\t */\r\n\teditorState: EditorState;\r\n\t/**\r\n\t * Ф-я изменения стейта\r\n\t */\r\n\tsetEditorState: (editorState: EditorState) => void;\r\n\t/**\r\n\t * Ф-я, закрывающая интерфейс редактирования ссылки\r\n\t */\r\n\tcloseLinkPicker: () => void;\r\n}\r\n\r\n/**\r\n * Форма добавления ссылки в расширенном редакторе текстов\r\n *\r\n * @param {LinkPickerProps} props\r\n * @returns {JSX.Element}\r\n */\r\nexport const LinkPicker: React.FC<LinkPickerProps> = ({\r\n\tcloseLinkPicker,\r\n\teditorState,\r\n\tsetEditorState,\r\n}) => {\r\n\tconst classes = useStyles();\r\n\r\n\tlet presetUrl = \"\";\r\n\tconst contentState = editorState.getCurrentContent();\r\n\tconst startKey = editorState.getSelection().getStartKey();\r\n\tconst startOffset = editorState.getSelection().getStartOffset();\r\n\tconst blockWithLinkAtBeginning = contentState.getBlockForKey(startKey);\r\n\tconst linkKey = blockWithLinkAtBeginning.getEntityAt(startOffset);\r\n\r\n\tif (linkKey) {\r\n\t\tconst linkInstance = contentState.getEntity(linkKey);\r\n\t\tpresetUrl = linkInstance.getData().url;\r\n\t}\r\n\r\n\tconst [url, setUrl] = useState<string>(presetUrl);\r\n\tconst [error, setError] = useState<boolean>();\r\n\r\n\tconst onChange = useCallback((e: ChangeEvent<HTMLInputElement>) => {\r\n\t\tif (e.target.value) {\r\n\t\t\tsetError(false);\r\n\t\t}\r\n\t\tsetUrl(e.target.value);\r\n\t}, []);\r\n\r\n\tconst saveUrl = useCallback(\r\n\t\t(e: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tif (!url) {\r\n\t\t\t\tsetError(true);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst contentState = editorState.getCurrentContent();\r\n\t\t\tconst contentStateWithEntity = contentState.createEntity(\r\n\t\t\t\t\"LINK\",\r\n\t\t\t\t\"MUTABLE\",\r\n\t\t\t\t{ url }\r\n\t\t\t);\r\n\t\t\tconst entityKey = contentStateWithEntity.getLastCreatedEntityKey();\r\n\t\t\tconst newEditorState = EditorState.set(editorState, {\r\n\t\t\t\tcurrentContent: contentStateWithEntity,\r\n\t\t\t});\r\n\r\n\t\t\tsetEditorState(\r\n\t\t\t\tRichUtils.toggleLink(\r\n\t\t\t\t\tnewEditorState,\r\n\t\t\t\t\tnewEditorState.getSelection(),\r\n\t\t\t\t\tentityKey\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t\tcloseLinkPicker();\r\n\t\t},\r\n\t\t[editorState, url]\r\n\t);\r\n\r\n\treturn (\r\n\t\t<Fade in={true}>\r\n\t\t\t<div className={classes.linkPicker}>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tplaceholder=\"Введите URL:\"\r\n\t\t\t\t\tonChange={onChange}\r\n\t\t\t\t\tvalue={url}\r\n\t\t\t\t\tclassName={clsx(classes.input, {\r\n\t\t\t\t\t\t[classes.inputError]: error,\r\n\t\t\t\t\t})}\r\n\t\t\t\t/>\r\n\t\t\t\t<IconButton size=\"small\" onMouseDown={saveUrl}>\r\n\t\t\t\t\t<CheckIcon />\r\n\t\t\t\t</IconButton>\r\n\t\t\t\t<IconButton size=\"small\" onClick={closeLinkPicker}>\r\n\t\t\t\t\t<CloseIcon />\r\n\t\t\t\t</IconButton>\r\n\t\t\t</div>\r\n\t\t</Fade>\r\n\t);\r\n};\r\n","import { IconButton, Tooltip } from \"@material-ui/core\";\r\nimport React, { useCallback, useState } from \"react\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport { getIcon } from \"../icons\";\r\nimport { EditorState, RichUtils } from \"draft-js\";\r\nimport clsx from \"clsx\";\r\nimport { richTextControls, ToolControl } from \"./toolControls\";\r\nimport { LinkPicker } from \"./LinkPicker\";\r\n\r\nconst useStyles = makeStyles({\r\n\trichEditorTools: {\r\n\t\tborderBottom: \"1px solid #d2d2d2\",\r\n\t},\r\n\tbtn: {\r\n\t\tpadding: 4,\r\n\t\tborderRadius: 0,\r\n\t\tborderRight: \"1px solid #d2d2d2\",\r\n\t},\r\n\ttextIcon: {\r\n\t\tfontWeight: 400,\r\n\t\tfontSize: 15,\r\n\t\theight: 24,\r\n\t\talignItems: \"center\",\r\n\t\tjustifyContent: \"center\",\r\n\t\tdisplay: \"flex\",\r\n\t\tpaddingLeft: 3,\r\n\t\tpaddingRight: 3,\r\n\t},\r\n});\r\n\r\ninterface RichTextEditorToolsProps {\r\n\t/**\r\n\t * Текущий стейт редактора\r\n\t */\r\n\teditorState: EditorState;\r\n\t/**\r\n\t * Ф-я обновления текущего стейта\r\n\t */\r\n\tsetEditorState: (editorState: EditorState) => void;\r\n\t/**\r\n\t * CSS-класс\r\n\t */\r\n\tclassName?: string;\r\n}\r\n\r\n/**\r\n * Панель инструментов расширенного редактора текстов\r\n *\r\n * @param {RichTextEditorToolsProps} props\r\n * @returns {JSX.Element}\r\n */\r\nexport const RichTextEditorTools: React.FC<RichTextEditorToolsProps> = React.memo(\r\n\t({\r\n\t\teditorState,\r\n\t\tsetEditorState,\r\n\t\tclassName,\r\n\t}: RichTextEditorToolsProps): JSX.Element => {\r\n\t\tconst classes = useStyles();\r\n\r\n\t\tconst [linkPicker, setLinkPicker] = useState<boolean>();\r\n\r\n\t\tconst openLinkPicker = useCallback(() => {\r\n\t\t\tconst selection = editorState.getSelection();\r\n\t\t\tif (!selection.isEmpty() && !selection.isCollapsed()) {\r\n\t\t\t\tsetLinkPicker(true);\r\n\t\t\t}\r\n\t\t}, [editorState]);\r\n\r\n\t\tconst closeLinkPicker = useCallback(() => setLinkPicker(false), []);\r\n\r\n\t\tconst onToggleControl = useCallback(\r\n\t\t\t({ type, style }: ToolControl) => (\r\n\t\t\t\te: React.MouseEvent<HTMLButtonElement, MouseEvent>\r\n\t\t\t) => {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\t\tcase \"block\":\r\n\t\t\t\t\t\tif (style) {\r\n\t\t\t\t\t\t\tsetEditorState(\r\n\t\t\t\t\t\t\t\tRichUtils.toggleBlockType(editorState, style)\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"inline\":\r\n\t\t\t\t\t\tif (style) {\r\n\t\t\t\t\t\t\tsetEditorState(\r\n\t\t\t\t\t\t\t\tRichUtils.toggleInlineStyle(editorState, style)\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"link\":\r\n\t\t\t\t\t\topenLinkPicker();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t[editorState, openLinkPicker, setEditorState]\r\n\t\t);\r\n\r\n\t\tconst currentStyle = editorState.getCurrentInlineStyle();\r\n\t\tconst selection = editorState.getSelection();\r\n\t\tconst blockType = editorState\r\n\t\t\t.getCurrentContent()\r\n\t\t\t.getBlockForKey(selection.getStartKey())\r\n\t\t\t.getType();\r\n\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<div className={clsx(classes.richEditorTools, className)}>\r\n\t\t\t\t\t{richTextControls.map((control, i) => {\r\n\t\t\t\t\t\tconst IconComponent =\r\n\t\t\t\t\t\t\tcontrol.icon && getIcon(control.icon);\r\n\t\t\t\t\t\tconst color =\r\n\t\t\t\t\t\t\t(control.style &&\r\n\t\t\t\t\t\t\t\tcontrol.type === \"inline\" &&\r\n\t\t\t\t\t\t\t\tcurrentStyle.has(control.style)) ||\r\n\t\t\t\t\t\t\t(control.type === \"block\" &&\r\n\t\t\t\t\t\t\t\tcontrol.style === blockType)\r\n\t\t\t\t\t\t\t\t? \"primary\"\r\n\t\t\t\t\t\t\t\t: \"default\";\r\n\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<Tooltip\r\n\t\t\t\t\t\t\t\tkey={i}\r\n\t\t\t\t\t\t\t\tplacement=\"bottom\"\r\n\t\t\t\t\t\t\t\ttitle={control.tooltip || \"\"}\r\n\t\t\t\t\t\t\t\tarrow={true}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\t\t\t\tclassName={classes.btn}\r\n\t\t\t\t\t\t\t\t\tsize=\"small\"\r\n\t\t\t\t\t\t\t\t\tonMouseDown={onToggleControl(control)}\r\n\t\t\t\t\t\t\t\t\tcolor={color}\r\n\t\t\t\t\t\t\t\t\tdisabled={control.disabled}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{IconComponent && <IconComponent />}\r\n\t\t\t\t\t\t\t\t\t{control.text && (\r\n\t\t\t\t\t\t\t\t\t\t<span className={classes.textIcon}>\r\n\t\t\t\t\t\t\t\t\t\t\t{control.text}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t})}\r\n\t\t\t\t</div>\r\n\t\t\t\t{linkPicker && (\r\n\t\t\t\t\t<LinkPicker\r\n\t\t\t\t\t\teditorState={editorState}\r\n\t\t\t\t\t\tcloseLinkPicker={closeLinkPicker}\r\n\t\t\t\t\t\tsetEditorState={setEditorState}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n);\r\n","import { makeStyles } from \"@material-ui/core\";\r\nimport { ContentBlock, ContentState, DraftDecorator } from \"draft-js\";\r\nimport React, { ReactNode } from \"react\";\r\n\r\nconst useStyles = makeStyles({\r\n\tlink: {\r\n\t\tcolor: \"#0088bb\",\r\n\t\ttextDecoration: \"underline\",\r\n\t},\r\n});\r\n\r\ninterface LinkPreviewProps {\r\n\t/**\r\n\t * Название ссылки\r\n\t */\r\n\tchildren?: ReactNode;\r\n\t/**\r\n\t * Адрес ссылки\r\n\t */\r\n\turl?: string;\r\n\t/**\r\n\t * Стейт расширенного редактора текстов\r\n\t */\r\n\tcontentState: ContentState;\r\n\t/**\r\n\t * Id ссылки\r\n\t */\r\n\tentityKey: string;\r\n}\r\n\r\n/**\r\n * Декоратор для отображения ссылок в расширенном редакторе текстов\r\n *\r\n * @param {LinkPreviewProps} props\r\n * @returns {JSX.Element}\r\n */\r\nexport const LinkPreview: React.FC<LinkPreviewProps> = (props) => {\r\n\tconst classes = useStyles();\r\n\r\n\tconst { url } = props.contentState.getEntity(props.entityKey).getData();\r\n\r\n\treturn (\r\n\t\t<a className={classes.link} href={url} title={`Ссылка: ${url}`}>\r\n\t\t\t{props.children}\r\n\t\t</a>\r\n\t);\r\n};\r\n\r\n/**\r\n * Ф-я для определения ссылки в стейте Draft.js\r\n *\r\n * @param {ContentBlock} contentBlock - блок с контентом\r\n * @param {Function} callback - callback\r\n * @param {ContentState} contentState - текущий стейт редактора\r\n * @returns {void}\r\n */\r\nexport const findLinkEntities = (\r\n\tcontentBlock: ContentBlock,\r\n\tcallback: (start: number, end: number) => void,\r\n\tcontentState: ContentState\r\n): void =>\r\n\tcontentBlock.findEntityRanges((character) => {\r\n\t\tconst entityKey = character.getEntity();\r\n\t\treturn (\r\n\t\t\tentityKey !== null &&\r\n\t\t\tcontentState.getEntity(entityKey).getType() === \"LINK\"\r\n\t\t);\r\n\t}, callback);\r\n","import { CompositeDecorator } from \"draft-js\";\r\nimport { findLinkEntities, LinkPreview } from \"./LinkPreview\";\r\n\r\n/**\r\n * Декораторы расширенного редактора текстов\r\n */\r\nexport const richTextEditorDecorators = new CompositeDecorator([\r\n\t{\r\n\t\tstrategy: findLinkEntities,\r\n\t\tcomponent: LinkPreview,\r\n\t},\r\n]);\r\n","import {\r\n\tContentState,\r\n\tconvertFromRaw,\r\n\tconvertToRaw,\r\n\tEditorState,\r\n} from \"draft-js\";\r\nimport { draftToMarkdown, markdownToDraft } from \"markdown-draft-js\";\r\n\r\n/**\r\n * Декоратор для _курсива_ в markdown\r\n */\r\nconst italicDecorator = () => \"*\";\r\n\r\n/**\r\n * Конвертирует стейт Draft.js в Markdown\r\n *\r\n * @param {EditorState} editorState - стейт редактора текстов\r\n * @returns {string}\r\n */\r\nexport const convertDraftToMarkdown = (editorState: EditorState): string => {\r\n\tconst content = editorState.getCurrentContent();\r\n\tconst rawObject = convertToRaw(content);\r\n\r\n\tconst markdown = draftToMarkdown(rawObject, {\r\n\t\tstyleItems: {\r\n\t\t\tITALIC: {\r\n\t\t\t\topen: italicDecorator,\r\n\t\t\t\tclose: italicDecorator,\r\n\t\t\t},\r\n\t\t},\r\n\t});\r\n\r\n\treturn markdown;\r\n};\r\n\r\n/**\r\n * Конвертирует строку в формате Markdown в объект-стейт редактора текстов Draft.js\r\n *\r\n * @param {string | undefined} markdown - строка в формате markdown\r\n * @returns {ContentState}\r\n */\r\nexport const convertMarkdownToDraft = (markdown: string = \"\"): ContentState =>\r\n\tconvertFromRaw(markdownToDraft(markdown));\r\n","import { makeStyles } from \"@material-ui/core/styles\";\r\nimport React, {\r\n\tcreateRef,\r\n\tuseCallback,\r\n\tuseEffect,\r\n\tuseRef,\r\n\tuseState,\r\n} from \"react\";\r\nimport { Editor, EditorState } from \"draft-js\";\r\nimport { RichTextEditorTools } from \"./RichTextEditorTools\";\r\nimport clsx from \"clsx\";\r\nimport { richTextEditorDecorators } from \"./decorators\";\r\nimport {\r\n\tconvertMarkdownToDraft,\r\n\tconvertDraftToMarkdown,\r\n} from \"./draftMarkdown\";\r\n\r\nconst border = \"1px solid #d2d2d2\";\r\n\r\nconst useStyles = makeStyles({\r\n\trichEditorWrapper: {\r\n\t\tbackground: \"#ffffff\",\r\n\t\tborder,\r\n\t\tmarginBottom: 20,\r\n\t\tposition: \"relative\",\r\n\t\ttransition: \"border .2s ease-in-out\",\r\n\t},\r\n\trichEditorWrapperFocus: {\r\n\t\tborderColor: \"#4dd0e1\",\r\n\t},\r\n\trichEditorArea: {\r\n\t\tpadding: 10,\r\n\t\theight: 200,\r\n\t\toverflowY: \"auto\",\r\n\t\ttransition: \"box-shadow .2s ease-in-out\",\r\n\t},\r\n\trichEditorAreaFocus: {\r\n\t\tboxShadow: \"inset 0px 0px 10px #caefff\",\r\n\t},\r\n\ttoolsUnfocus: {\r\n\t\topacity: 0.95,\r\n\t\ttransition: \"opacity .2s ease-in-out\",\r\n\t},\r\n});\r\n\r\nconst styleMap = {\r\n\tBOLD: {\r\n\t\tfontWeight: 600,\r\n\t},\r\n\tLINK: {\r\n\t\tcolor: \"#0088bb\",\r\n\t},\r\n};\r\n\r\ninterface RichTextEditorProps {\r\n\t/**\r\n\t * Обработчик изменения текста\r\n\t */\r\n\tonChange: (value: string) => void;\r\n\t/**\r\n\t * Дефолтное значение\r\n\t */\r\n\tdefaultValue?: string;\r\n\t/**\r\n\t * Редактор очищается при изменении этого свойства\r\n\t */\r\n\tforceClean?: number;\r\n\t/**\r\n\t * Подсказка\r\n\t */\r\n\tplaceholder?: string;\r\n}\r\n\r\n/**\r\n * Расширенный редактор текста. Экспортирует строку в формате Markdown.\r\n * - Фреймворк для создания редактора: [Draft.js](https://draftjs.org/)\r\n * - Конвертер стейта Draft.js в Markdown: [markdown-draft-js](https://www.npmjs.com/package/markdown-draft-js)\r\n *\r\n * @param {RichTextEditorProps} props - св-ва компонента\r\n * @returns {JSX.Element}\r\n */\r\nexport const RichTextEditor: React.FC<RichTextEditorProps> = React.memo(\r\n\t({\r\n\t\tdefaultValue,\r\n\t\tforceClean,\r\n\t\tplaceholder,\r\n\t\t...props\r\n\t}: RichTextEditorProps): JSX.Element => {\r\n\t\tconst classes = useStyles();\r\n\r\n\t\tconst [editorState, setEditorState] = useState(\r\n\t\t\tEditorState.createWithContent(\r\n\t\t\t\tconvertMarkdownToDraft(defaultValue),\r\n\t\t\t\trichTextEditorDecorators\r\n\t\t\t)\r\n\t\t);\r\n\r\n\t\tconst onChange = useCallback(\r\n\t\t\t(nextEditorState: EditorState) => setEditorState(nextEditorState),\r\n\t\t\t[]\r\n\t\t);\r\n\r\n\t\tconst ref = createRef<any>();\r\n\t\tconst [focus, setFocus] = useState<boolean>();\r\n\r\n\t\tconst onBlur = useCallback(() => setFocus(false), [editorState]);\r\n\r\n\t\tconst onClickArea = useCallback(() => {\r\n\t\t\tif (ref && ref.current) {\r\n\t\t\t\tref.current.focus();\r\n\t\t\t\tsetFocus(true);\r\n\t\t\t}\r\n\t\t}, [ref]);\r\n\r\n\t\tuseEffect(() => {\r\n\t\t\tif (forceClean) {\r\n\t\t\t\tsetEditorState(\r\n\t\t\t\t\tEditorState.createEmpty(richTextEditorDecorators)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}, [forceClean]);\r\n\r\n\t\tuseEffect(() => props.onChange(convertDraftToMarkdown(editorState)), [\r\n\t\t\teditorState,\r\n\t\t]);\r\n\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName={clsx(classes.richEditorWrapper, {\r\n\t\t\t\t\t[classes.richEditorWrapperFocus]: focus,\r\n\t\t\t\t})}\r\n\t\t\t>\r\n\t\t\t\t<RichTextEditorTools\r\n\t\t\t\t\teditorState={editorState}\r\n\t\t\t\t\tsetEditorState={setEditorState}\r\n\t\t\t\t\tclassName={!focus ? classes.toolsUnfocus : undefined}\r\n\t\t\t\t/>\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={clsx(classes.richEditorArea, {\r\n\t\t\t\t\t\t[classes.richEditorAreaFocus]: focus,\r\n\t\t\t\t\t})}\r\n\t\t\t\t\tonClick={onClickArea}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Editor\r\n\t\t\t\t\t\teditorState={editorState}\r\n\t\t\t\t\t\tonChange={onChange}\r\n\t\t\t\t\t\tspellCheck={true}\r\n\t\t\t\t\t\tcustomStyleMap={styleMap}\r\n\t\t\t\t\t\tonBlur={onBlur}\r\n\t\t\t\t\t\tref={ref}\r\n\t\t\t\t\t\tplaceholder={placeholder}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n);\r\n","import { IconButton, Zoom } from \"@material-ui/core\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport React, {\r\n\tcreateRef,\r\n\tuseCallback,\r\n\tuseEffect,\r\n\tuseMemo,\r\n\tuseState,\r\n} from \"react\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport { getIcon } from \"../icons\";\r\n\r\nconst useStyles = makeStyles({\r\n\tcomment: {\r\n\t\tmarginBottom: 10,\r\n\t\tbackground: \"#e8e8e8\",\r\n\t\tpadding: 10,\r\n\t\tborderRadius: 5,\r\n\t},\r\n\tauthor: {\r\n\t\tfontWeight: 500,\r\n\t},\r\n\tdate: {\r\n\t\topacity: 0.8,\r\n\t\tmarginBottom: 10,\r\n\t},\r\n\ttext: {\r\n\t\toverflow: \"hidden\",\r\n\t\tposition: \"relative\",\r\n\t},\r\n\ttextHidden: {\r\n\t\t\"&:after\": {\r\n\t\t\tposition: \"absolute\",\r\n\t\t\tcontent: \"''\",\r\n\t\t\tbackground: \"linear-gradient(to top, #e8e8e8, transparent)\",\r\n\t\t\twidth: \"100%\",\r\n\t\t\theight: 30,\r\n\t\t\tdisplay: \"block\",\r\n\t\t\tbottom: 0,\r\n\t\t\tzIndex: 1,\r\n\t\t},\r\n\t},\r\n\treadMoreButton: {\r\n\t\tbottom: 0,\r\n\t\tposition: \"absolute\",\r\n\t\tmarginLeft: \"calc(50% - 15px)\",\r\n\t\tzIndex: 2,\r\n\t\ttransition: \"transform .3s linear\",\r\n\t\tcolor: \"#252733\",\r\n\t},\r\n\treadMoreButtonClose: {\r\n\t\ttransform: \"rotate(180deg)\",\r\n\t\tposition: \"static\",\r\n\t},\r\n});\r\n\r\nconst ArrowIcon = getIcon(\"ExpandMore\");\r\n\r\n/**\r\n * Максимальная высота блока с текстом комментария\r\n */\r\nconst maxHeight = 100;\r\n\r\nexport interface CommentProps {\r\n\t/**\r\n\t * Содержимое коментария в формате Markdown\r\n\t */\r\n\ttext: string;\r\n\t/**\r\n\t * Автор\r\n\t */\r\n\tauthor: string;\r\n\t/**\r\n\t * Дата\r\n\t */\r\n\tdate: string;\r\n\t/**\r\n\t * Индекс в списке комментариев\r\n\t */\r\n\tindex?: number;\r\n\t/**\r\n\t * Если true - комментарий будет анимирован\r\n\t */\r\n\tshowLastComment?: boolean;\r\n\t/**\r\n\t * Если True - комментарий будет показан без анимации\r\n\t */\r\n\tvisible?: boolean;\r\n\t/**\r\n\t * Длительность анимации\r\n\t */\r\n\tanimationTimeout?: number;\r\n}\r\n\r\n/**\r\n * Компонент для отображения комментария\r\n * - Пакет для рендеринга html из Markdown: [react-markdown](https://www.npmjs.com/package/react-markdown)\r\n *\r\n * @param {CommentProps} props\r\n * @returns {JSX.Element}\r\n */\r\nexport const SingleComment: React.FC<CommentProps> = React.memo(\r\n\t({ author, date, text, ...props }: CommentProps) => {\r\n\t\tconst classes = useStyles();\r\n\r\n\t\tconst ref = createRef<HTMLDivElement>();\r\n\r\n\t\tconst [hidden, setHidden] = useState<boolean>();\r\n\t\tconst [needReadMoreButton, setNeedReadMoreButton] = useState<boolean>();\r\n\r\n\t\tuseEffect(() => {\r\n\t\t\tif (ref && ref.current) {\r\n\t\t\t\tconst initialHeight = ref.current.getBoundingClientRect()\r\n\t\t\t\t\t.height;\r\n\r\n\t\t\t\tif (hidden === undefined && initialHeight > maxHeight) {\r\n\t\t\t\t\tsetHidden(true);\r\n\t\t\t\t\tsetNeedReadMoreButton(true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, [ref, hidden]);\r\n\r\n\t\tconst toggleHidden = useCallback(() => setHidden(!hidden), [hidden]);\r\n\r\n\t\tconst height = useMemo(() => (hidden ? maxHeight : undefined), [\r\n\t\t\thidden,\r\n\t\t]);\r\n\r\n\t\treturn (\r\n\t\t\t<div className={classes.comment}>\r\n\t\t\t\t<div className={classes.author}>{author}</div>\r\n\t\t\t\t<div className={classes.date}>{date}</div>\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={clsx(classes.text, {\r\n\t\t\t\t\t\t[classes.textHidden]: hidden,\r\n\t\t\t\t\t})}\r\n\t\t\t\t\tref={ref}\r\n\t\t\t\t\tstyle={{ maxHeight: height }}\r\n\t\t\t\t>\r\n\t\t\t\t\t<ReactMarkdown>{text}</ReactMarkdown>\r\n\t\t\t\t\t{needReadMoreButton && (\r\n\t\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\t\tsize=\"small\"\r\n\t\t\t\t\t\t\tclassName={clsx(classes.readMoreButton, {\r\n\t\t\t\t\t\t\t\t[classes.readMoreButtonClose]: !hidden,\r\n\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\tonClick={toggleHidden}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{ArrowIcon && <ArrowIcon />}\r\n\t\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n);\r\n","import { Button } from \"@material-ui/core\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport { CommentProps, SingleComment } from \"./Comment\";\r\n\r\nconst useStyles = makeStyles({\r\n\tcommentsWrapper: {\r\n\t\tmarginBottom: 20,\r\n\t},\r\n\tcomments: {\r\n\t\tmarginTop: 20,\r\n\t\tpaddingRight: 5,\r\n\t\tmaxHeight: 700,\r\n\t\toverflowY: \"auto\",\r\n\t\toverflowX: \"hidden\",\r\n\t},\r\n});\r\n\r\ninterface CommentsProps {\r\n\t/**\r\n\t * Массив комментариев\r\n\t */\r\n\tdata: CommentProps[];\r\n}\r\n\r\n/**\r\n * Список комментариев\r\n *\r\n * @param {CommentsProps} props\r\n * @returns {JSX.Element}\r\n */\r\nexport const Comments: React.FC<CommentsProps> = React.memo(({ data }) => {\r\n\tconst classes = useStyles();\r\n\r\n\treturn (\r\n\t\t<div className={classes.commentsWrapper}>\r\n\t\t\t<div className={classes.comments}>\r\n\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t{data.map((comment, i) => (\r\n\t\t\t\t\t\t<SingleComment {...comment} key={i} />\r\n\t\t\t\t\t))}\r\n\t\t\t\t</React.Fragment>\r\n\t\t\t</div>\r\n\t\t\t<Button color=\"primary\">+ Показать больше</Button>\r\n\t\t\t<Button color=\"primary\">- Скрыть</Button>\r\n\t\t</div>\r\n\t);\r\n});\r\n","import { Button } from \"@material-ui/core\";\r\nimport React, { useCallback, useState } from \"react\";\r\nimport { RichTextEditor } from \"./components/RichTextEditor/RichTextEditor\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport { CommentProps } from \"./components/Comments/Comment\";\r\nimport { Comments } from \"./components/Comments/Comments\";\r\nimport fakeApiComments from \"./fake-api.json\";\r\n\r\nconst useStyles = makeStyles({\r\n\tappWrapper: {\r\n\t\tmargin: \"0 auto\",\r\n\t\tmaxWidth: 700,\r\n\t\tminHeight: \"100vh\",\r\n\t\tpadding: 10,\r\n\t\tbackground: \"#f5f5f5\",\r\n\t},\r\n\r\n\t\"@global\": {\r\n\t\t\"*::-webkit-scrollbar\": {\r\n\t\t\twidth: 10,\r\n\t\t},\r\n\t\t\"*::-webkit-scrollbar-thumb\": {\r\n\t\t\tbackgroundColor: \"rgba(0,0,0,.1)\",\r\n\t\t\tborderRadius: 5,\r\n\t\t},\r\n\t},\r\n});\r\n\r\nfunction App() {\r\n\tconst classes = useStyles();\r\n\r\n\tconst [comments, setComments] = useState<CommentProps[]>(fakeApiComments);\r\n\tconst [forceClean, setForceClean] = useState<number>();\r\n\tconst [currentComment, setCurrentComment] = useState<string>();\r\n\r\n\tconst leaveComment = useCallback(() => {\r\n\t\tif (currentComment) {\r\n\t\t\tsetComments([\r\n\t\t\t\t{\r\n\t\t\t\t\tauthor: \"Тест Тестов\",\r\n\t\t\t\t\tdate: \"23.09.2020 20:31\",\r\n\t\t\t\t\ttext: currentComment,\r\n\t\t\t\t},\r\n\t\t\t\t...comments,\r\n\t\t\t]);\r\n\t\t\tsetForceClean(+new Date());\r\n\t\t\tsetCurrentComment(undefined);\r\n\r\n\t\t\tconsole.log(currentComment);\r\n\t\t}\r\n\t}, [currentComment, comments]);\r\n\r\n\treturn (\r\n\t\t<div className={classes.appWrapper}>\r\n\t\t\t<RichTextEditor\r\n\t\t\t\tonChange={setCurrentComment}\r\n\t\t\t\tforceClean={forceClean}\r\n\t\t\t/>\r\n\t\t\t<Button\r\n\t\t\t\tvariant=\"contained\"\r\n\t\t\t\tcolor=\"primary\"\r\n\t\t\t\tsize=\"small\"\r\n\t\t\t\tonClick={leaveComment}\r\n\t\t\t>\r\n\t\t\t\tОставить комментарий\r\n\t\t\t</Button>\r\n\t\t\t<Comments data={comments} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default App;\r\n","import { createMuiTheme } from \"@material-ui/core\";\r\n\r\nexport const customTheme = createMuiTheme({\r\n\tpalette: {\r\n\t\tprimary: {\r\n\t\t\tmain: \"#0088bb\",\r\n\t\t},\r\n\t},\r\n\toverrides: {\r\n\t\tMuiTooltip: {\r\n\t\t\ttooltip: {\r\n\t\t\t\tfontSize: 13,\r\n\t\t\t\tfontWeight: 400,\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n","import { CssBaseline, ThemeProvider } from \"@material-ui/core\";\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport App from \"./App\";\r\nimport { customTheme } from \"./customTheme\";\r\n\r\nReactDOM.render(\r\n\t<React.StrictMode>\r\n\t\t<CssBaseline />\r\n\t\t<ThemeProvider theme={customTheme}>\r\n\t\t\t<App />\r\n\t\t</ThemeProvider>\r\n\t</React.StrictMode>,\r\n\tdocument.getElementById(\"root\")\r\n);\r\n"],"sourceRoot":""}